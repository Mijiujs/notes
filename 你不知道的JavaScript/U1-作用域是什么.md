# 作用域是什么

### 编译原理
通常将js归类为”动态“或”解释执行“语言，与传统编译语言不同，它不是提前编译的，js的编译过程不是发生在构建之前，大部分情况下发生在代码执行前的几微妙（甚至更短）的时间内。在我们所要讨论的作用域背后，js引擎用尽了各种方法（比如JIT、可以延迟编译甚至实施重编译）来保证性能最佳。

在传统编译语言的流程中，程序中的一段源代码在执行之前会经历三个步骤，统称为”编译“

1.分词/词法分析：将字符串分解成词法单元，如var a = 2分解为var、a、=、2、;

2.解析/语法分析：将词法单元流（数组）转化为抽象语法树（AST）

3.代码生成：将AST转化为可执行的代码

但是javaScript引擎要复杂的多，如在语法分析和代码生成阶段有特定的步骤对运行性能进行优化、对冗余元素进行优化

### 理解作用域

* 引擎：从头到尾负责整个js程序的编译及执行过程
* 编译器：负责词法分析、语法分析及代码生成
* 作用域：负责收集并维护由所有声明的变量组成的一系列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限。

变量的赋值操作会执行2个动作
* 编译器在会在当前作用域中声明一个变量（若之前未声明）
* 在运行时引擎会在作用域中查找该变量，若找到即赋值

编译器术语

* LHS查询
* RHS查询

### 小结
作用域是一套规则，用于确定在何处以及如何查找变量。变量赋值则使用LHS查询；获取变量的值则使用RHS查询。

LHS、RHS查询会现在当前作用域中开始，若未找到则向上级作用域中查找，直至抵达全局作用域。

# 词法作用域

### 小结
词法作用域意味着作用域是由书写代码时函数声明的位置来决定。编译的词法分析阶段基本就能得知全部标识符在哪里以及如何声明，从而能够预测在执行过程中如何对他们进行查找。

2个机制可以欺骗词法作用域，导致的副作用：引擎无法在编译时对作用域查找进行优化。建议不要使用。

* eval()：可以对一段声明代码进行包装，并借此来修改已经存在的词法作用域（在运行时）
* with：将一个对象的引用当做作用域来处理，将对象的属性当做作用域中的标识符来处理，从而创建一个新的词法作用域（在运行时）

# 函数作用域和块作用域

### 部分概念
* 函数声明、函数表达式

* 匿名、具名

* 立即执行函数表达式IIFE

# 提升

var a = 2，js实际会将其看成两个声明，var a; 和 a = 2，第一个定义声明实在编译阶段进行，第二个赋值声明会被留在原地等待执行阶段

函数声明和变量声明都会被提升，但是函数会首先被提升，然后才是变量

# 作用域闭包





